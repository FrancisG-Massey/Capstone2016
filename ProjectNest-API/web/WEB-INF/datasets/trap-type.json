{
    "before": "
        SELECT * FROM extend_session(#string:session-token#::text, #string:session-timeout#::interval) es WHERE es IS NOT NULL;
    ",
    "GET" : "
        WITH logged_user AS (
            SELECT
                user_id,
                user_isadmin,
                user_isinactive
            FROM users u
            JOIN session s ON u.user_id = s.session_userid
            WHERE (#string:session-token# IS NOT NULL) AND (s.session_token = #string:session-token#)
            LIMIT 1
        )

        SELECT 
            tt.traptype_id as id,
            tt.traptype_name as name,
            tt.traptype_model as model,
            tt.traptype_note as note
        FROM 
            logged_user lu,
            traptype tt
        WHERE
            (lu.user_isinactive = false) AND
            ((#bigint:id# IS NULL) OR (tt.traptype_id = #bigint:id#)) AND
            ((#string:name# IS NULL) OR (lower(tt.traptype_name) LIKE lower('%' || #string:name# || '%')))
        GROUP BY
            tt.traptype_id
        ORDER BY
            tt.traptype_id;
    ",
    "POST" : "
        INSERT INTO traptype (
            traptype_name,
            traptype_model,
            traptype_note
        )
        SELECT
            #string:name#,
            #string:model#,
            #string:note#
        WHERE
            (#bigint:id# IS NULL) AND
            (NOT (traptype_model IS NULL AND traptype_name IS NULL))
        RETURNING
            traptype_id;
    ",
    "PUT" : "",
    "DELETE" : ""
}